import{_ as Q,j as N,o as Z,K as pe,a as m,b as f,g as i,f as p,w as R,k as v,T as O,L as J,M as ee,N as te,u as G,E as x,A as I,t as S,c as y,q as ae,h as fe,i as H,e as z,d as ve,m as he,l as ge}from"./index-dlVRCVJv.js";import{_ as P}from"./BaseInput-gOZxOp-4.js";import{_ as we}from"./MyVehicle-Bm2_vFSX.js";import"./VehicleDetails-Ds6fqLv3.js";import"./RentalDetails-C5DQ3b5J.js";const W=e=>(ee("data-v-eadaa2cd"),e=e(),te(),e),ye={class:"flex flex-col gap-8 px-5 sm:justify-center items-center sm:px-8 mt-12 mb-20"},be=W(()=>i("h2",{class:"text-lg sm:text-xl font-Montserrat font-semibold"},"Almost there, last step",-1)),xe={class:"flex justify-between items-center max-w-4xl w-full mx-auto"},ke=J('<li class="relative mb-6 flex-1" data-v-eadaa2cd><div class="flex items-center" data-v-eadaa2cd><div class="z-10 flex items-center justify-center w-6 h-6 bg-goldenYellow-default rounded-full ring-4 ring-white drop-shadow-md shrink-0" data-v-eadaa2cd><svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12" data-v-eadaa2cd><path stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M1 5.917 5.724 10.5 15 1.5" data-v-eadaa2cd></path></svg></div><div class="flex w-full bg-goldenYellow-default h-1" data-v-eadaa2cd></div></div><div class="mt-3" data-v-eadaa2cd><h3 class="font-medium" data-v-eadaa2cd>Step 1</h3><h4 class="font-light text-sm md:text-base" data-v-eadaa2cd>Choose Dates</h4></div></li><li class="relative mb-6 flex-1" data-v-eadaa2cd><div class="flex items-center" data-v-eadaa2cd><div class="z-10 flex items-center justify-center w-6 h-6 bg-goldenYellow-default rounded-full ring-4 ring-white shrink-0 drop-shadow-md" data-v-eadaa2cd><svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12" data-v-eadaa2cd><path stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M1 5.917 5.724 10.5 15 1.5" data-v-eadaa2cd></path></svg></div><div class="flex w-full bg-goldenYellow-default h-1" data-v-eadaa2cd></div></div><div class="mt-3" data-v-eadaa2cd><h3 class="font-medium" data-v-eadaa2cd>Step 2</h3><h4 class="font-light text-sm md:text-base" data-v-eadaa2cd>Choose Vehicle</h4></div></li>',2),_e={class:"relative mb-6 flex-1"},Ie={class:"flex items-center"},Se=W(()=>i("div",{class:"z-10 flex items-center justify-center w-6 h-6 bg-goldenYellow-default rounded-full ring-4 ring-white shrink-0 drop-shadow-md"},[i("svg",{class:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 12"},[i("path",{stroke:"white","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"4",d:"M1 5.917 5.724 10.5 15 1.5"})])],-1)),Pe={key:0,class:"flex w-full bg-goldenYellow-default h-1"},Ne=W(()=>i("div",{class:"mt-3"},[i("h3",{class:"font-medium"},"Step 3"),i("h4",{class:"font-light text-sm md:text-base"},"Choose Extras")],-1)),Ve=J('<li class="relative mb-6" data-v-eadaa2cd><div class="flex items-center" data-v-eadaa2cd><div class="z-10 flex items-center justify-center w-6 h-6 bg-goldenYellow-default rounded-full ring-4 ring-white shrink-0 drop-shadow-md" data-v-eadaa2cd></div></div><div class="mt-3" data-v-eadaa2cd><h3 class="font-medium" data-v-eadaa2cd>Step 4</h3><h4 class="font-light text-sm md:text-base" data-v-eadaa2cd>Payment</h4></div></li>',1),Ce={__name:"Stepper3",setup(e){const t=N(!1);return Z(()=>t.value=!0),pe(()=>t.value=!1),(n,r)=>(m(),f("section",ye,[be,i("ol",xe,[ke,i("li",_e,[i("div",Ie,[Se,p(O,{name:"stepper-line"},{default:R(()=>[t.value?(m(),f("div",Pe)):v("",!0)]),_:1})]),Ne]),Ve])]))}},Me=Q(Ce,[["__scopeId","data-v-eadaa2cd"]]),se=e=>(ee("data-v-e40a1c09"),e=e(),te(),e),Ee={class:"pb-12"},$e=se(()=>i("h2",{class:"text-base font-semibold leading-7"},"Personal Information",-1)),Le={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-6"},je={class:"sm:col-span-3"},Te={key:0,class:"text-red-default text-sm"},De={class:"sm:col-span-3"},Be={key:0,class:"text-red-default text-sm"},qe={class:"col-span-full"},Ue={key:0,class:"text-red-default text-sm"},Fe={key:0,class:"sm:col-span-3"},Re={key:0,class:"text-red-default text-sm"},Ae={key:0,class:"sm:col-span-3"},Ye={key:0,class:"text-red-default text-sm"},ze={class:"sm:col-span-3"},Oe={key:0,class:"text-red-default text-sm"},Ge={key:0,class:"col-span-full"},We=se(()=>i("label",{for:"create-account",class:"text-sm leading-6"},"Create an account for faster bookings in the future.",-1)),He={class:"col-span-full"},Ke={key:0,class:"text-red-default text-sm"},Xe={class:"sm:col-span-2 sm:col-start-1"},Qe={key:0,class:"text-red-default text-sm"},Ze={class:"sm:col-span-2"},Je={key:0,class:"text-red-default text-sm"},et={class:"sm:col-span-2"},tt={key:0,class:"text-red-default text-sm"},at={__name:"PersonalDetailForm",props:{errorMsg:Object,invalidInput:Object},emits:["handleCheckbox","validationResult"],setup(e,{emit:t}){const n=G(),r=t,o=N(!1),l=sessionStorage.getItem("user"),s=L=>y({get(){return n.state.bookings.billingFormData[L]},set(d){n.dispatch("bookings/updateField",{field:L,value:d})}}),k=s("firstName"),h=s("lastName"),b=s("email"),C=s("password"),g=s("confirmPassword"),_=s("phoneNumber"),c=s("address"),E=s("country"),M=s("city"),$=s("postalCode"),A=()=>{o.value=!o.value,r("handleCheckbox",o.value)};return(L,d)=>(m(),f("section",Ee,[$e,i("div",Le,[i("div",je,[p(P,{labelValue:"First Name",inputType:"text",inputId:"first-name",modelValue:x(k),"onUpdate:modelValue":d[0]||(d[0]=u=>I(k)?k.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.firstName},null,8,["modelValue","errorInput"]),e.errorMsg.firstName?(m(),f("span",Te,S(e.errorMsg.firstName),1)):v("",!0)]),i("div",De,[p(P,{labelValue:"Last Name",inputType:"text",inputId:"last-name",modelValue:x(h),"onUpdate:modelValue":d[1]||(d[1]=u=>I(h)?h.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.lastName},null,8,["modelValue","errorInput"]),e.errorMsg.lastName?(m(),f("span",Be,S(e.errorMsg.lastName),1)):v("",!0)]),i("div",qe,[p(P,{labelValue:"Email Address",inputType:"email",inputId:"email",modelValue:x(b),"onUpdate:modelValue":d[2]||(d[2]=u=>I(b)?b.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.email},null,8,["modelValue","errorInput"]),e.errorMsg.email?(m(),f("span",Ue,S(e.errorMsg.email),1)):v("",!0)]),p(O,{name:"password-reveal"},{default:R(()=>[o.value?(m(),f("div",Fe,[p(P,{labelValue:"Password",inputType:"password",inputId:"password",modelValue:x(C),"onUpdate:modelValue":d[3]||(d[3]=u=>I(C)?C.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.password},null,8,["modelValue","errorInput"]),e.errorMsg.password?(m(),f("span",Re,S(e.errorMsg.password),1)):v("",!0)])):v("",!0)]),_:1}),p(O,{name:"confirm-password-reveal"},{default:R(()=>[o.value?(m(),f("div",Ae,[p(P,{labelValue:"Confirm Password",inputType:"password",inputId:"confirm-password",modelValue:x(g),"onUpdate:modelValue":d[4]||(d[4]=u=>I(g)?g.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.confirmPassword},null,8,["modelValue","errorInput"]),e.errorMsg.confirmPassword?(m(),f("span",Ye,S(e.errorMsg.confirmPassword),1)):v("",!0)])):v("",!0)]),_:1}),i("div",ze,[p(P,{labelValue:"Phone Number",inputType:"text",inputId:"phone-number",modelValue:x(_),"onUpdate:modelValue":d[5]||(d[5]=u=>I(_)?_.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.phoneNumber},null,8,["modelValue","errorInput"]),e.errorMsg.phoneNumber?(m(),f("span",Oe,S(e.errorMsg.phoneNumber),1)):v("",!0)]),x(l)?v("",!0):(m(),f("div",Ge,[i("input",{type:"checkbox",id:"create-account",class:"mr-2",onClick:A}),We])),i("div",He,[p(P,{labelValue:"Street Address",inputType:"text",inputId:"street-address",modelValue:x(c),"onUpdate:modelValue":d[6]||(d[6]=u=>I(c)?c.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.address},null,8,["modelValue","errorInput"]),e.errorMsg.address?(m(),f("span",Ke,S(e.errorMsg.address),1)):v("",!0)]),i("div",Xe,[p(P,{labelValue:"Country",inputType:"text",inputId:"country",modelValue:x(E),"onUpdate:modelValue":d[7]||(d[7]=u=>I(E)?E.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.country},null,8,["modelValue","errorInput"]),e.errorMsg.country?(m(),f("span",Qe,S(e.errorMsg.country),1)):v("",!0)]),i("div",Ze,[p(P,{labelValue:"City",inputType:"text",inputId:"city",modelValue:x(M),"onUpdate:modelValue":d[8]||(d[8]=u=>I(M)?M.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.city},null,8,["modelValue","errorInput"]),e.errorMsg.city?(m(),f("span",Je,S(e.errorMsg.city),1)):v("",!0)]),i("div",et,[p(P,{labelValue:"ZIP / Postal Code",inputType:"text",inputId:"postal-code",modelValue:x($),"onUpdate:modelValue":d[9]||(d[9]=u=>I($)?$.value=u:null),modelModifiers:{trim:!0},errorInput:e.invalidInput.postalCode},null,8,["modelValue","errorInput"]),e.errorMsg.postalCode?(m(),f("span",tt,S(e.errorMsg.postalCode),1)):v("",!0)])])]))}},st=Q(at,[["__scopeId","data-v-e40a1c09"]]);var re="https://js.stripe.com/v3",rt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,K="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",ot=function(){for(var t=document.querySelectorAll('script[src^="'.concat(re,'"]')),n=0;n<t.length;n++){var r=t[n];if(rt.test(r.src))return r}return null},X=function(t){var n="",r=document.createElement("script");r.src="".concat(re).concat(n);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r},nt=function(t,n){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"4.0.0",startTime:n})},D=null,U=null,F=null,lt=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},it=function(t,n){return function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}},dt=function(t){return D!==null?D:(D=new Promise(function(n,r){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&t&&console.warn(K),window.Stripe){n(window.Stripe);return}try{var o=ot();if(o&&t)console.warn(K);else if(!o)o=X(t);else if(o&&F!==null&&U!==null){var l;o.removeEventListener("load",F),o.removeEventListener("error",U),(l=o.parentNode)===null||l===void 0||l.removeChild(o),o=X(t)}F=it(n,r),U=lt(r),o.addEventListener("load",F),o.addEventListener("error",U)}catch(s){r(s);return}}),D.catch(function(n){return D=null,Promise.reject(n)}))},ut=function(t,n,r){if(t===null)return null;var o=t.apply(void 0,n);return nt(o,r),o},B,oe=!1,ne=function(){return B||(B=dt(null).catch(function(t){return B=null,Promise.reject(t)}),B)};Promise.resolve().then(function(){return ne()}).catch(function(e){oe||console.warn(e)});var ct=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];oe=!0;var o=Date.now();return ne().then(function(l){return ut(l,n,o)})};const mt={class:"mb-4"},pt=i("h2",{class:"text-base font-semibold leading-7 mb-10"},"Payment Information",-1),ft=i("div",{id:"payment-element"},null,-1),vt=[pt,ft],ht={__name:"StripeForm",emits:["stripeLoaded"],setup(e,{emit:t}){const n=t,r=G(),l=y(()=>r.getters["bookings/calculateTotalPrice"]).value*100,s=N(null),k=N(null),h=N(null),b=N(null),C={variables:{colorPrimary:"#000",fontWeightNormal:"500",borderRadius:"6px"}};return Z(async()=>{try{if(!k.value){k.value=await ct("pk_test_51Pbmp4A9qLO0uuCbYSdegz2pzKqGajgNHvcVzewqNhhUKIQDnh1xYQ0Rh6HFjSlHSnPr3RNXOAMBZ92MubmSg3os00AteGsM26");const{data:g}=await ae.post("https://vroomrent-1ca5fd89bbcf.herokuapp.com/api/create-payment-intent",{amount:l});h.value=g.clientSecret,b.value=g.paymentIntentId,s.value=k.value.elements({clientSecret:h.value,appearance:C}),s.value.create("payment").mount("#payment-element"),n("stripeLoaded",{stripe:k.value,elements:s.value})}}catch(g){console.error(g)}}),(g,_)=>(m(),f("section",mt,vt))}},gt={__name:"CheckoutForms",setup(e){const t=G(),n=fe(),r=N(!0),o=N(!1),l=H({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phoneNumber:"",address:"",country:"",city:"",postalCode:""}),s=H({firstName:!1,lastName:!1,email:!1,password:!1,confirmPassword:!1,phoneNumber:!1,address:!1,country:!1,city:!1,postalCode:!1}),k=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,h=N(!1),b=N(""),C=sessionStorage.getItem("user");let g=null,_=null;const c=y(()=>t.getters["bookings/billingFormData"]),E=y(()=>t.getters["bookings/pickupLocation"]),M=y(()=>t.getters["bookings/dropoffLocation"]),$=y(()=>t.getters["bookings/pickupDate"]),A=y(()=>t.getters["bookings/dropoffDate"]),L=y(()=>t.getters["bookings/vehicleId"]),d=y(()=>t.getters["bookings/calculateTotalPrice"]),u=y(()=>t.getters["bookings/selectedExtras"]),le=y(()=>t.getters["bookings/fuelExtraCharge"]),ie=y(()=>t.getters["bookings/childSeatCount"]),de=({stripe:a,elements:w})=>{_=a,g=w,r.value=!1},ue=a=>{o.value=a},ce=()=>{let a=!0;if(Object.keys(l).forEach(w=>{l[w]=""}),Object.keys(s).forEach(w=>{s[w]=!1}),c.value.firstName||(l.firstName="First name is required",s.firstName=!0,a=!1),c.value.lastName||(l.lastName="Last name is required",s.lastName=!0,a=!1),!c.value.email)l.email="Email is required",s.email=!0,a=!1;else if(!k.test(c.value.email))return l.email="Invalid email format",s.email=!0,!1;return c.value.phoneNumber||(l.phoneNumber="Phone number is required",s.phoneNumber=!0,a=!1),c.value.address||(l.address="Streer address is required",s.address=!0,a=!1),c.value.country||(l.country="Country is required",s.country=!0,a=!1),c.value.city||(l.city="City is required",s.city=!0,a=!1),c.value.postalCode||(l.postalCode="Postal code is required",s.postalCode=!0,a=!1),o.value&&(console.log("Checkbox is checked. Validating passwords..."),c.value.password||(l.password="Password is required",s.password=!0,a=!1),c.value.confirmPassword||(l.confirmPassword="Password confirmation is required",s.confirmPassword=!0,a=!1),c.value.password&&c.value.confirmPassword&&c.value.password!==c.value.confirmPassword&&(l.password="Passwords are not the same",l.confirmPassword="Passwords are not the same",s.password=!0,s.confirmPassword=!0,a=!1)),a},me=async()=>{const a=c.value;if(h.value=!1,b.value="",!!ce()){if(!_||!g){r.value=!0;return}r.value=!1;try{M.value||(M.value=null),r.value=!0;let w=C;if(o.value){const V={firstName:a.firstName,lastName:a.lastName,email:a.email};try{t.commit("setUserData",V),w=await t.dispatch("registerUser",{password:a.password})}catch(T){T.message==="Email already exists"&&(l.email=T.message,s.email=!0),console.error("Error registering user: ",T),r.value=!1;return}}const{error:j,paymentIntent:q}=await _.confirmPayment({elements:g,confirmParams:{payment_method_data:{billing_details:{name:`${a.firstName} ${a.lastName}`,email:a.email,phone:a.phoneNumber,address:{line1:a.address,country:a.country,city:a.city,postal_code:a.postalCode}}},return_url:"http://localhost:5173/booking/receipt"},redirect:"if_required"});if(j){console.error("Error confirming payment:",j),h.value=!0,b.value=j.message,r.value=!1;return}console.log("Payment confirmed!");const Y={firstName:a.firstName,lastName:a.lastName,email:a.email,phoneNumber:a.phoneNumber,total:d.value,billingDetails:{address:a.address,country:a.country,city:a.city,zipCode:a.postalCode},bookDetails:{pickupLocation:E.value,dropoffLocation:M.value,pickupDate:$.value,dropoffDate:A.value},stripeTranscactionId:q.id,userId:w,vehicleId:L.value,bookingExtras:{selectedExtrasId:u.value.map(V=>V._id),fuelExtra:le.value>0,childSeatCount:ie.value}};try{const V=await ae.post("https://vroomrent-1ca5fd89bbcf.herokuapp.com/api/create-booking",Y);console.log("Booking response:",V.data),n.push("/booking/receipt")}catch(V){console.error("Error posting booking data to database",V),h.value=!0,b.value="There was an error creating your booking. Please try again.";try{await _.paymentIntents.cancel(q.id),console.log("Payment canceled due to booking creation failure")}catch(T){console.error("Error canceling payment:",T)}}r.value=!1}catch(w){console.error("Error creating payment:",w),h.value=!0,b.value="There was an error processing your payment. Please try again.",r.value=!1}}};return(a,w)=>{const j=z("BaseModal"),q=z("BaseSpinner"),Y=z("BaseButton");return m(),f("form",{onSubmit:ge(me,["prevent"])},[p(j,{show:h.value,title:"Payment Failed",message:b.value,singleButton:"",onClose:w[0]||(w[0]=V=>h.value=!1)},null,8,["show","message"]),r.value?(m(),ve(q,{key:0})):v("",!0),p(st,{onHandleCheckbox:ue,errorMsg:l,invalidInput:s},null,8,["errorMsg","invalidInput"]),p(ht,{onStripeLoaded:de}),p(Y,{id:"submit",type:"submit",disabled:r.value,widthClass:"w-full"},{default:R(()=>[he("Complete Reservation")]),_:1},8,["disabled"])],32)}}},wt={class:"flex flex-col-reverse justify-center gap-20 my-4 px-6 md:items-center lg:items-start lg:flex-row"},It={__name:"CheckoutView",setup(e){return(t,n)=>(m(),f("section",null,[p(Me),i("div",wt,[p(gt),p(we,{"show-continue-button":!1})])]))}};export{It as default};
