import{s as q,h as M,p as j,j as u,i as k,o as S,e as y,a as t,d as f,w as g,b as m,q as b,t as v,k as p,g as r,l as U,f as h,m as O}from"./index-dlVRCVJv.js";import{F as R}from"./FormWrapper-BVf3UkIF.js";import{_ as V}from"./BaseInput-gOZxOp-4.js";const $=r("div",{class:"sm:mx-auto sm:w-full sm:max-w-sm"},[r("h2",{class:"text-center text-2xl font-semibold"},"Change Password")],-1),A={key:0,class:"text-center mt-8 rounded bg-transparent text-white font-medium py-2 sm:mx-auto sm:w-full sm:max-w-sm drop-shadow-sm bg-red-default"},F={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-sm"},L={class:""},D={key:0,class:"text-red-default text-sm"},W={class:""},Y={key:0,class:"text-red-default text-sm"},z={key:2,class:"flex min-h-full flex-1 flex-col justify-center px-6 py-12 mt-16 lg:px-8 bg-white drop-shadow-md rounded-lg max-w-sm md:max-w-lg mx-auto text-center"},G=r("h2",{class:"text-2xl font-semibold text-red-default"},"Token has expired!",-1),H=[G],Z={__name:"ResetPassword",setup(J){const x=q(),B=M(),T=j(),l=u(""),n=u(""),c=u(!1),i=u(!1),_=u(!0),d=u(""),o=k({oldPassword:"",newPassword:""}),a=k({oldPassword:!1,newPassword:!1}),C=()=>{let s=!0;return d.value="",Object.keys(o).forEach(e=>{o[e]=""}),Object.keys(a).forEach(e=>{a[e]=!1}),l.value||(o.oldPassword="Old password is being required",a.oldPassword=!0,s=!1),n.value||(o.newPassword="New password is being required",a.newPassword=!0,s=!1),l.value&&n.value&&l.value===n.value&&(d.value="You cant set the new password to the previous password",a.oldPassword=!0,a.newPassword=!0,s=!1),s},I=async()=>{if(!C())return;const s=x.query.token;c.value=!0;try{await b.post("https://vroomrent-1ca5fd89bbcf.herokuapp.com/auth/reset-password",{token:s,oldPassword:l.value,newPassword:n.value}),T("Password changed successfully",{type:"success"}),B.push("/login")}catch(e){e.response?(console.log("Error response from server: ",e.response.data),d.value=e.response.data.message||"Error resetting password"):(console.error("Unexpected error occured",e),d.value="Unexpected error occured")}finally{c.value=!1}},E=async()=>{const s=x.query.token;try{(await b.post("https://vroomrent-1ca5fd89bbcf.herokuapp.com/auth/check-token",{token:s})).data.valid?i.value=!0:i.value=!1}catch(e){console.error("Error checking token validity: ",e),i.value=!1}finally{_.value=!1}};return S(()=>E()),(s,e)=>{const P=y("BaseSpinner"),N=y("AccentButton");return _.value?(t(),f(P,{key:0})):i.value?(t(),f(R,{key:1},{default:g(()=>[$,d.value?(t(),m("span",A,v(d.value),1)):p("",!0),r("div",F,[c.value?(t(),f(P,{key:0})):p("",!0),r("form",{onSubmit:U(I,["prevent"]),class:"space-y-6"},[r("div",L,[h(V,{labelValue:"Current Password",inputType:"password",inputId:"oldPassword",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=w=>l.value=w),modelModifiers:{trim:!0},errorInput:a.oldPassword},null,8,["modelValue","errorInput"]),o.oldPassword?(t(),m("span",D,v(o.oldPassword),1)):p("",!0)]),r("div",W,[h(V,{labelValue:"New Password",inputType:"password",inputId:"newPassword",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=w=>n.value=w),modelModifiers:{trim:!0},errorInput:a.newPassword},null,8,["modelValue","errorInput"]),o.newPassword?(t(),m("span",Y,v(o.newPassword),1)):p("",!0)]),h(N,{widthClass:"w-full",disabled:c.value},{default:g(()=>[O("Change Password")]),_:1},8,["disabled"])],32)])]),_:1})):(t(),m("div",z,H))}}};export{Z as default};
